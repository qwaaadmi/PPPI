<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Karaoke</title>
</head>
<body>

<h2>Login</h2>

<input id="email" placeholder="email"><br><br>
<input id="password" type="password" placeholder="password"><br><br>
<input id="room" placeholder="room code"><br><br>

<button onclick="join()">Join room</button>

<hr>

<div id="app" style="display:none">
  <h1>ğŸ¤ Karaoke Room</h1>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
let socket;

async function join() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const room = document.getElementById("room").value;

  // 1ï¸âƒ£ Ğ»Ğ¾Ğ³Ñ–Ğ½
  const res = await fetch("/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });

  if (!res.ok) {
    alert("Login failed");
    return;
  }

  const data = await res.json();
  const token = data.token;

  // 2ï¸âƒ£ socket Ğ· Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼
  socket = io({
    auth: { token }
  });

  socket.on("connect", () => {
    console.log("âœ… socket connected");

    document.body.querySelector("h2").style.display = "none";
    document.querySelector("button").style.display = "none";

    document.getElementById("app").style.display = "block";

    socket.emit("joinRoom", { code: room });
  });

  socket.on("connect_error", err => {
    console.error("âŒ socket error:", err.message);
  });
}
</script>

</body>
</html>
