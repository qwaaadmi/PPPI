<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Karaoke</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>

<h2>Karaoke Login</h2>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>

<hr>

<h2>Room</h2>
<input id="room" placeholder="Room name">
<button onclick="joinRoom()">Join Room</button>

<hr>

<h2>Player</h2>
<button onclick="playSong(0)">Play Song 1</button>
<button onclick="playSong(1)">Play Song 2</button>
<button onclick="playSong(2)">Play Song 3</button>

<p id="status"></p>

<script>
let socket = null;
let token = null;

function register() {
  fetch("/api/register", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      username: username.value,
      password: password.value
    })
  })
  .then(r => r.json())
  .then(d => status.innerText = d.message);
}

function login() {
  fetch("/api/login", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      username: username.value,
      password: password.value
    })
  })
  .then(r => r.json())
  .then(d => {
    if (d.token) {
      token = d.token;
      status.innerText = "Logged in!";
      connectSocket();
    } else {
      status.innerText = d.message;
    }
  });
}

function connectSocket() {
  socket = io({
    auth: {
      token: token
    }
  });

  socket.on("connect", () => {
    status.innerText = "Socket connected!";
  });

  socket.on("playSong", index => {
    alert("Play song #" + (index + 1));
  });

  socket.on("connect_error", err => {
    status.innerText = err.message;
  });
}

function joinRoom() {
  socket.emit("joinRoom", room.value);
  status.innerText = "Joined room " + room.value;
}

function playSong(index) {
  socket.emit("playSong", {
    room: room.value,
    index: index
  });
}
</script>

</body>
</html>
